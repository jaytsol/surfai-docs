# ✍️ 중요한 결정 기록 (왜 이렇게 만들었을까요?)
최종 업데이트: 2025년 6월 29일

이 문서는 SurfAI 프로젝트를 만들면서 우리가 어떤 중요한 결정을 내렸고, 왜 그런 결정을 했는지 쉽게 설명해 드립니다.

---

### 1. 로그인 방식: `JWT`와 `HttpOnly` 쿠키 사용

-   **날짜:** 2025-06-21
-   **고민했던 점:**
    -   처음에는 일반적인 로그인 방식(세션-쿠키)을 생각했어요.
    -   그다음에는 스마트폰 앱에서도 잘 작동하도록 `JWT`라는 로그인 정보를 사용자 컴퓨터에 직접 저장하는 방법을 논의했어요.
    -   마지막으로, 보안과 편리함을 모두 잡기 위해 `JWT`를 `HttpOnly` 쿠키라는 안전한 방식으로 사용자 컴퓨터에 전달하기로 했어요.
-   **결정:** `JWT`라는 로그인 정보(접근 토큰과 갱신 토큰)를 만들고, 이것을 `HttpOnly` `Secure` 쿠키라는 안전한 방법으로 사용자 컴퓨터와 주고받기로 했어요.
-   **왜 이렇게 했을까요?:**
    -   **보안 강화 (해킹 방지):** `HttpOnly`라는 기능을 사용하면, 웹사이트를 해킹하려는 나쁜 프로그램이 사용자 로그인 정보에 직접 접근하는 것을 막을 수 있어요. 그래서 로그인 정보가 도난당할 위험을 크게 줄일 수 있어요.
    -   **서버 부담 줄이기:** `JWT`를 사용하면 서버가 사용자 로그인 상태를 일일이 기억할 필요가 없어져요. 그래서 나중에 사용자가 많아져도 서버를 쉽게 늘릴 수 있어서 좋아요.
    -   **자동 로그인 처리:** 웹사이트가 서버에 요청을 보낼 때, 사용자 컴퓨터에 저장된 로그인 정보가 자동으로 함께 보내져요. 그래서 개발자가 로그인 처리를 더 쉽게 할 수 있어요.

---

### 2. 서비스 배포 방식: `Docker`와 `Google Cloud Run` 사용

-   **날짜:** 2025-06-22
-   **고민했던 점:**
    -   웹사이트 화면을 배포할 때는 `Cloudflare Pages`나 `Vercel` 같은 쉬운 서비스를 생각했어요.
    -   뒤에서 일하는 서버를 배포할 때는 `Google Cloud Platform`의 여러 서비스들을 검토했어요.
    -   마지막으로, 웹사이트와 서버 프로그램을 모두 `Docker`라는 표준화된 상자에 담아서 `Google Cloud Run`이라는 곳에 올리기로 했어요.
-   **결정:** 웹사이트(`Next.js`)와 뒤에서 일하는 서버(`NestJS`)를 각각 `Docker` 상자로 만들고, `Google Cloud Run`에 배포하기로 했어요.
-   **왜 이렇게 했을까요?:**
    -   **어디서든 똑같이 작동:** `Docker`를 사용하면 개발할 때나 실제로 서비스할 때나 똑같은 환경에서 작동해요. 그래서 "내 컴퓨터에서는 잘 됐는데..." 같은 문제가 생기지 않아요.
    -   **나중에 옮기기 쉬움:** `Docker` 상자는 웹 서비스를 배포하는 표준 방식과 같아요. 그래서 나중에 `AWS`, `Azure` 같은 다른 서비스로 옮겨야 할 때도 쉽게 바꿀 수 있어요.
    -   **자동으로 배포:** 코드를 고치면 자동으로 테스트하고 서비스에 올리는 과정을 `GitHub Actions`라는 도구로 만들 수 있어서, 개발과 배포가 더 쉬워져요.

---

### 3. 인터넷 주소 나누기: 서브도메인 사용

-   **날짜:** 2025-06-20
-   **고민했던 점:**
    -   **하나의 주소로 모두 사용:** `surfai.org/`와 `surfai.org/api/`처럼 하나의 인터넷 주소로 웹사이트와 서버를 모두 사용하는 방법을 생각했어요. 이렇게 하면 `CORS` 및 쿠키 문제가 줄어들 수 있지만, 인터넷 트래픽을 나누는 복잡한 설정이 필요했어요.
    -   **주소 나누어 사용:** `app.surfai.org`와 `api.surfai.org`처럼 각 서비스의 역할을 명확히 나누어 주소를 사용하는 방법도 생각했어요.
-   **결정:** 웹사이트는 `surfai.org`를 사용하고, 뒤에서 일하는 서버는 `api.surfai.org`처럼 서브도메인을 나누어 사용하기로 했어요.
-   **왜 이렇게 했을까요?:**
    -   처음 설정하기가 더 쉽고 간단해요. (`Google Cloud Run`의 기능을 활용했어요)
    -   웹사이트와 서버의 역할이 인터넷 주소 수준에서 명확하게 나뉘어서, 각 서비스에 맞는 보안 규칙이나 속도 개선 기능을 적용하기 좋아요.
    -   복잡했던 로그인 정보(쿠키) 문제는 서버에서 올바른 설정을 해주면서 해결했어요.

---

### 4. 데이터 보관 규칙: 파일은 자동 삭제, 기록은 계속 보관

-   **날짜:** 2025-06-23
-   **고민했던 점:**
    -   저장 공간 비용을 아끼기 위해 2일이 지난 모든 그림/영상 파일과 기록을 지우는 방법을 생각했어요.
    -   하지만 이렇게 하면 사용자가 자신이 만들었던 그림/영상의 기록(어떤 설정으로 만들었는지 등)을 영원히 잃게 되어 불편할 수 있다고 생각했어요.
-   **결정:** 실제로 만들어진 그림/영상 파일은 2일 후에 `Cloudflare R2`에서 자동으로 지워지지만, 그림/영상을 만들었던 기록(어떤 설정으로 만들었는지 등)은 사용자가 직접 지우기 전까지 계속 보관하기로 했어요.
-   **왜 이렇게 했을까요?:**
    -   가장 많은 저장 공간을 차지하는 파일만 지워서 저장 공간 비용을 효과적으로 아낄 수 있어요.
    -   사용자는 자신이 만들었던 그림/영상의 기록을 계속 볼 수 있어서 편리해요.
    -   웹사이트에서는 파일이 지워진 그림/영상에 대해 "기간이 지났어요" 같은 메시지를 보여줘서 사용자가 쉽게 알 수 있도록 했어요.